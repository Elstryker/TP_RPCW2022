extends layout

block content



    center

        h1  As minhas publicações

        button.w3-button.w3-xlarge.w3-blue-gray.w3-border.w3-border-white.w3-round-large(onclick="document.getElementById('addPub').style.display='block'") Adicionar Publicação

        .w3-modal(id='addPub')
            form.w3-modal-content.w3-animate-top.w3-round-large(action="/recursos/file" method="POST")
                .w3-container.w3-teal
                    span(class='w3-button w3-display-topright' onclick="document.getElementById('addPub').style.display='none'") &times;
                    h2 Adicionar Publicação
                .w3-container
                    .w3-row.w3-section
                        div.w3-rest
                            input.w3-input.w3-border(type="text" name="titulo" id="tituloRecurso" placeholder="Titulo" required)
                    .w3-row.w3-section
                        div.w3-rest
                            input.w3-input.w3-border(type="text" name="descricao" id="descRecurso" placeholder="Descrição")
                    .w3-row.w3-section
                        div.w3-rest
                            input.w3-input.w3-border(type="text" name="categoria" id="tipoRecurso" placeholder="Categoria")
                    .w3-row.w3-section
                        div.w3-rest
                            input.w3-input.w3-border(type="text" name="autor" id="autorRecurso" class='file-author' placeholder="Autor" required)
                    .w3-row.w3-section
                        div.w3-rest
                                label Data de criação
                                input(type='date', name='dataCriacao' id="dataCriacao")
                    .w3-row.w3-section
                        div.w3-rest
                            label(for='form-title') Título
                            input.file-title(type='text', name='title', id='tituloRecurso' class='file-title' placeholder='Título')
                            br
                            label(for='form-author') Autor
                            input.file-author(type='text', name='author', class='file-author' placeholder='Autor')
                            br
                            label(for='form-creationDate') Data de criação
                            input.file-creationDate(type='date',  class='file-creationDate' name='creationDate')
                            br
                            label(for='form-file') Ficheiro
                            input.file(type='file', name='file', class='file' placeholder='Ficheiro')
                            br
                            input(type="button", value='Adicionar mais um ficheiro', id='add-one-file')
                    
                    
                    input(type="submit", value='Criar' id='submit-file')

                    button(class="w3-btn w3-red" onclick="document.getElementById('addPub').style.display='none'") Cancelar
                    p



        h1  Publicações 
        each p in pubs
            .w3-round-large.w3-teal(style='width:90%;')
                .publicacao
                    .pubInfo
                        ul.w3-ul
                            li
                                p(style='display: inline') Titulo: 
                                a(style='display: inline' href="/recursos/"+p.idRecurso)= p.titulo
                            li= `Descrição: ${p.descricao}`
                            li
                                p(style='display: inline') Publicador: 
                                a(style='display: inline' href="/perfil/"+p.idAutor)= p.nomeAutor
                            li= `Data Criação: ${p.dataCriacao}`
                            if p.dataModificacao
                                li= `Data Modificacao: ${p.dataModificacao}`
                            else
                                li 
                    .pubButtons
                        button.w3-button.w3-large.w3-teal.w3-border.w3-border-white.w3-round-large(onclick=`document.getElementById('${"comment_"+p._id}').style.display='block'`) Comentar
                        p
                        button.w3-button.w3-large.w3-teal.w3-border.w3-border-white.w3-round-large Download
                    .pubRating
                        each r in recursos.dados
                            if r._id == p.idRecurso
                                -var classif = r.ratings
                        
                                -var i = 5
                                
                                while i>0
                                    - i = i-1
                                    if classif >= 1
                                        span.fa.fa-star.checked
                                        - classif = classif - 1
                                    else if classif == 0
                                        span.fa.fa-star-o.checked
                                    else
                                        span.fa.fa-star-half-o.checked
                                        - classif = 0
                                
                    .pubDownload
                        button.w3-button.w3-large.w3-amber.w3-border.w3-border-white.w3-round-large(style="width:100px") Editar 
                        p
                        button.w3-button.w3-large.w3-red.w3-border.w3-border-white.w3-round-large(style="width:100px") Apagar
            p
            .w3-modal(id='comment_'+p._id)
                form.w3-modal-content.w3-animate-top.w3-round-large(action="/publicacoes/comentar/"+p._id method="POST")
                    .w3-container.w3-teal
                        span(class='w3-button w3-display-topright' onclick=`document.getElementById('${"comment_"+p._id}').style.display='none'`) &times;
                        h2= "Adicionar comentário a " + p.titulo  
                    .w3-container
                        .w3-row.w3-section
                            div.w3-rest
                                input.w3-input.w3-border(type="text" name="comment" id="comment" placeholder="Comentário" required)
                        
                        button(type="submit" class="w3-btn w3-teal w3-block w3-section") Comentar

                        button(class="w3-btn w3-red" onclick=`document.getElementById('${"comment_"+p._id}').style.display='none'`) Cancelar
                        p
